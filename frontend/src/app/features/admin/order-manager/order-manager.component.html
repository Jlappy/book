<h2>Quản lý đơn hàng theo người dùng</h2>

<label for="user">Chọn người dùng:</label>
<select [(ngModel)]="selectedUserId" (change)="onSelectUser(selectedUserId)">
  <option value="">-- Chọn người dùng --</option>
  <option *ngFor="let user of users" [value]="user._id">
    {{ user.fullName || user.email }}
  </option>
</select>

<div *ngIf="orders.length > 0" class="charts">
  <!-- Biểu đồ doanh thu -->
  <highcharts-chart [options]="chartOptions" style="width: 100%; height: 400px; display: block;">
  </highcharts-chart>

  <!-- Biểu đồ tròn trạng thái -->
  <highcharts-chart [options]="chartOptionsPie" style="width: 100%; height: 400px; display: block;">
  </highcharts-chart>
</div>

<!-- Bảng dữ liệu đơn hàng -->
<table mat-table [dataSource]="orders" class="mat-elevation-z8" *ngIf="orders.length > 0">

  <ng-container matColumnDef="user">
    <th mat-header-cell *matHeaderCellDef>Người dùng</th>
    <td mat-cell *matCellDef="let order">
      {{ order.user?.fullName || order.user?.email }}
    </td>
  </ng-container>

  <ng-container matColumnDef="total">
    <th mat-header-cell *matHeaderCellDef>Tổng tiền</th>
    <td mat-cell *matCellDef="let order">{{ order.total | number:'1.0-0' }} ₫</td>
  </ng-container>

  <ng-container matColumnDef="status">
    <th mat-header-cell *matHeaderCellDef>Trạng thái</th>
    <td mat-cell *matCellDef="let order">
      <span [ngClass]="{ 'text-green': order.status === 'completed', 'text-orange': order.status === 'pending' }">
        {{ order.status === 'completed' ? 'Hoàn tất' : 'Đang xử lý' }}
      </span>
    </td>
  </ng-container>

  <ng-container matColumnDef="createdAt">
    <th mat-header-cell *matHeaderCellDef>Ngày tạo</th>
    <td mat-cell *matCellDef="let order">
      {{ order.createdAt | date:'dd/MM/yyyy HH:mm' }}
    </td>
  </ng-container>

  <ng-container matColumnDef="actions">
    <th mat-header-cell *matHeaderCellDef>Thao tác</th>
    <td mat-cell *matCellDef="let order">
      <button mat-button color="primary" *ngIf="order.status === 'pending'" (click)="markAsCompleted(order._id)">
        Hoàn tất
      </button>
    </td>
  </ng-container>

  <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
  <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
</table>